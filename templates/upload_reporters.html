<!DOCTYPE html>
<html>
<head>
    <title>Upload Reporters - Holiday Reporter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #2F5233 0%, #4A7C59 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 10px;
        }
        h1 { color: #2F5233; }
        button {
            background: #2F5233;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }
        button:disabled { background: #ccc; }
        #status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .success { background: #d4edda; color: #155724; display: block; }
        .error { background: #f8d7da; color: #721c24; display: block; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Upload Reporters from Weekend Reporter</h1>
        
        <p><strong>Steps:</strong></p>
        <ol>
            <li>Download backup from weekend_reporter: <code>/api/backup</code></li>
            <li>Upload it here</li>
            <li>Done - passwords synced!</li>
        </ol>
        
        <input type="file" id="fileInput" accept=".json" style="width:100%; padding:10px; margin:20px 0;">
        
        <button id="uploadBtn" onclick="uploadFile()" disabled>Upload Reporters File</button>
        
        <div id="status"></div>
    </div>

    <script>
        document.getElementById('fileInput').addEventListener('change', function(e) {
            document.getElementById('uploadBtn').disabled = !e.target.files.length;
        });
        
        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const statusDiv = document.getElementById('status');
            const uploadBtn = document.getElementById('uploadBtn');
            
            statusDiv.style.display = 'none';
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'Uploading...';
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = async function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    const reporters = backup.reporters;
                    
                    if (!reporters) {
                        statusDiv.className = 'error';
                        statusDiv.textContent = 'Error: No reporters found in file';
                        uploadBtn.disabled = false;
                        uploadBtn.textContent = 'Upload Reporters File';
                        return;
                    }
                    
                    const response = await fetch('/api/upload-reporters', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ reporters: reporters })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        statusDiv.className = 'success';
                        statusDiv.textContent = `✓ Success! Uploaded ${result.reporters_count} reporters. Verified: ${result.verified}`;
                    } else {
                        statusDiv.className = 'error';
                        statusDiv.textContent = `✗ Error: ${result.error}`;
                    }
                } catch (error) {
                    statusDiv.className = 'error';
                    statusDiv.textContent = `✗ Error: ${error.message}`;
                }
                
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'Upload Reporters File';
            };
            
            reader.readAsText(file);
        }
    </script>
</body>
</html>
